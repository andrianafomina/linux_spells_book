# Пользователи и права доступа

/etc/passwd - БД пользователей системы

useradd - более низкоуровневая команда создания пользователя (нужно прописывать дополнительно - директории, группу, права)

adduser - запускает удобный мастер создания пользователя

sudo - утилита по управлению правами доступа пользователя в системе

/etc/sudoers - основной файл конфигурации sudo

Важный нюанс: sudo **не передает переменные окружения по умолчанию,** по умолчанию переменные окружения пользователя не наследуются. sudo создает новый сеанс, где переменные окружения сбрасываются, чтобы предотвратить потенциальные риски безопасности.

Пример 1

export NEWUSER="exampleuser"
sudo -E sh -c 'echo $NEWUSER'

Пример 2

NEWUSER="exampleuser" sudo sh -c 'echo $NEWUSER’

ПРАВА ДОСТУПА У ПОЛЬЗОВАТЕЛЕЙ

- **--** - нет прав, совсем;
- **-x** - разрешено только выполнение файла, как программы но не изменение и не чтение;
- **w-** - разрешена только запись и изменение файла;
- **wx** - разрешено изменение и выполнение, но в случае с каталогом, вы не можете посмотреть его содержимое;
- **r--** - права только на чтение;
- **r-x** - только чтение и выполнение, без права на запись;
- **rw-** - права на чтение и запись, но без выполнения;
- **rwx** - все права;
- **-s** - установлен SUID или SGID бит, первый отображается в поле для владельца, второй для группы;
- **-t** - установлен sticky-bit, а значит пользователи не могут удалить этот файл.

![image.png](%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8%20%D0%B8%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B0%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%201349a18f25f880338115e07e12bcf9c0/image.png)

![image.png](%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8%20%D0%B8%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B0%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%201349a18f25f880338115e07e12bcf9c0/image%201.png)

![image.png](%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8%20%D0%B8%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B0%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%201349a18f25f880338115e07e12bcf9c0/image%202.png)

![image.png](%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8%20%D0%B8%20%D0%BF%D1%80%D0%B0%D0%B2%D0%B0%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%B0%201349a18f25f880338115e07e12bcf9c0/image%203.png)

Про команду судо

su  «substitute user» — заменить пользователя
sudo  «substitute user and do» — подменить пользователя и выполнить

su требует пароль целевой учетной записи, на кого переключаемся.
sudo требует пароль текущего пользователя и запускает от его имени команды, которым требуются права суперюзера.

Например, мы сидим под пользователем user и хотим войти под  John:

user@dev:/$ su john
Будет запрошен пароль, нужно ввести пароль именно от учетной записи john, а не от user.

А вот пример с sudo:

user@dev:/$ sudo -u john whoami
А здесь нужно ввести пароль от учетной записи user, а не от John или рута. Но для этого случая сперва необходимо добавить пермишены для пользователя user в файл /etc/sudoers.

user ALL=(ALL:ALL) ALL
Редактировать этот файл можно по средствам команды visudo. А свалидировать конфиг можно командой visudo -c. Редактирование этого файла через visodu хорошо тем, что если вы допустите ошибку, то при сохранении, оно сообщит о ней.
А для чего нужен дефис после su?

Для очистки переменных и чтобы пользоваться чистой оболочкой при переключении на другого пользователя.

Авторизуемся под пользователем user и экспортируем переменную:

ssh user@pc
export a="test"
Теперь у пользователя user есть переменная "a" которая = test.

Переключаемся на пользователя John и смотрим переменную "a"

su john
echo $a
Вывелась строчка test. То есть все что мы задали под user, перекочевало в оболочку john. А теперь добавим дефис:

su - john
echo $a
Переменная $a больше не выводится. Чистая оболочка. Кстати с этим дефисом часто косячат и потом долго не могут понять в чем причина. Переменные вроде были заданы, а потом куда-то пропали.

su (с дефисом) — сначала переключается пользователь, а затем запускается shell, зачищаются все переменные.
su (без дефиса) — переключает пользователя, оставляя переменные окружения старого пользователя.
У sudo есть подобные ключи -s -i

user@pc:/$ sudo -s
Запустится оболочка с правами root

user@pc:/$ sudo -i
Запустится оболочка, но уже с чтением файлов root/.profile/.bashrc и т.п. Можно попробовать добавить экспорт переменной в .profile, сделать sudo -s/-i и увидеть что с ключом -i переменная выведется на экран.

По сути sudo -i = команде sudo su -. Но обычно за sudo su - в приличных местах можно получить по шапке. Это плохая практика! Так как это порождает дополнительный процесс и больше гемора с набором самой команды.

В чем разница между sudo su, sudo -i, sudo /bin/bash

Команда su позволяет изменить текущего пользователя терминала на другого. Команда sudo выполняет команду от имени root пользователя. Теперь разберем сам вопрос.

sudo su - выполняет команду su от имени суперпользователя. Таким образом, сначала используется sudo чтобы получить права суперпользователя, а затем пользователь меняется на root с помощью su. При этом вы останетесь в той же директории потому, что выполняется ваш .bashrc. А также .profile пользователя root поэтому вы окажетесь в окружении root.

sudo -i - похожая команда, опция -i указывает утилите что нужно переключиться в консоль от имени суперпользователя. На этот раз вы уже окажетесь в домашней папке root, и будет выполнен его .bashrc и .profile.

sudo /bin/bash - запускает еще одну оболочку bash от имени суперпользователя. Файлы конфигурации не читаются, но выполняется только .bashrc вашего пользователя. Вы не окажетесь в окружении root, а просто останетесь в своем окружении с правами суперпользователя.

# useradd -c "User Vasya" -g admin -d /home/vasya -s /bin/bash vasya

Создать пользователя vasya, домашним каталогом будет создана директория /home/vasya, в качестве системной оболочки будет назначен /bin/bash, пользователь будет включен в группу admin, кроме того для учетной записи будет создан комментарий "User Vasya"

# useradd vasya

Создать пользователя vasya

# usermod -c "User FTP" -g system -d /ftp/ftpuser -s /bin/nologin ftpuser

Изменить пользователя

# userdel -r vasya

Удалить пользователя с именем vasya и его дом. директорию

# groupadd [ group_name ]

Создать группу с именем group_name

# chage -E 2005-12-31 vasya

Установить дату окончания действия учётной записи vasya

# groupdel [ group_name ]

Удалить группу group_name

# groupmod -n test new_test

Переименовать группу test в new_test

# passwd

Изменить пароль текущего пользователя

# passwd vasya

Изменить пароль пользователя vasya